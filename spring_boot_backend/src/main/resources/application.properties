# ===========================
# SERVER CONFIG
# ===========================
server.port=8081
spring.application.name=AndroidInsta Backend

# ===========================
# MYSQL DATABASE CONFIG
# ===========================
spring.datasource.url=jdbc:mysql://localhost:3306/instaclone?createDatabaseIfNotExist=true&useSSL=false&serverTimezone=Asia/Ho_Chi_Minh&allowPublicKeyRetrieval=true
spring.datasource.driverClassName=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=123456

# ===========================
# JPA / HIBERNATE CONFIG
# ===========================
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ===========================
# JWT Configuration
# ===========================
jwt.secret=AndroidInsta_Super_Secret_Key_For_JWT_Token_Generation_Must_Be_At_Least_512_Bits_Long_For_HS512
jwt.accessTokenExpiration=86400000
jwt.refreshTokenExpiration=604800000
jwt.issuer=AndroidInsta
jwt.audience=AndroidInsta-Users

# ===========================
# Redis Configuration
# ===========================
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=
spring.data.redis.timeout=3000
spring.data.redis.database=0

# Redis Connection Pool (Lettuce - default for Spring Boot)
spring.data.redis.lettuce.pool.enabled=true
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=2000ms
spring.data.redis.lettuce.shutdown-timeout=200ms

# ===================================================================
# Redis Cache Configuration - PROFESSIONAL APPROACH
# ===================================================================
# Redis is RE-ENABLED but ONLY for:
# 1. Session storage (JWT refresh tokens)
# 2. Rate limiting (API throttling)
# 3. WebSocket coordination (online users, typing indicators)
# 4. Pub/Sub (real-time events via Kafka + Redis)
# 5. Simple counters/flags (post counts, user flags)
#
# ‚ùå Redis is NOT used for:
# 1. Complex DTO caching (removed all @Cacheable from DTOs)
# 2. Object serialization via Jackson (causes LinkedHashMap errors)
# 3. Full response caching (database with indexes is fast enough)
#
# See REDIS_BEST_PRACTICES.md for complete documentation.
# ===================================================================

spring.cache.type=redis
spring.cache.redis.time-to-live=600000
spring.cache.redis.cache-null-values=false
spring.cache.redis.use-key-prefix=true
spring.cache.redis.key-prefix=androidinsta:

# Redis Performance
spring.data.redis.client-type=lettuce
spring.data.redis.connect-timeout=2000ms
spring.data.redis.client-name=androidinsta-backend

# ===========================
# Kafka Configuration
# ===========================
spring.kafka.bootstrap-servers=localhost:9092

# Consumer Configuration
spring.kafka.consumer.group-id=androidinsta-group
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=true
spring.kafka.consumer.auto-commit-interval=5000
spring.kafka.consumer.max-poll-records=100
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=*
spring.kafka.consumer.properties.isolation.level=read_committed

# Producer Configuration
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.max.in.flight.requests.per.connection=5
spring.kafka.producer.properties.enable.idempotence=true
spring.kafka.producer.compression-type=snappy

# Kafka Performance & Reliability
spring.kafka.listener.ack-mode=batch
spring.kafka.listener.concurrency=3
spring.kafka.listener.poll-timeout=3000
spring.kafka.properties.session.timeout.ms=30000
spring.kafka.properties.heartbeat.interval.ms=10000
spring.kafka.properties.request.timeout.ms=60000

# ===========================
# Cloudinary Configuration
# ===========================
cloudinary.cloud-name=da8ldqctz
cloudinary.api-key=456122717799773
cloudinary.api-secret=maNikNVr-dxsRWMsjH7VKn1z1L4

# ===========================
# File Upload Configuration
# ===========================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=200MB
spring.servlet.multipart.max-request-size=200MB

# ===========================
# Actuator endpoints for monitoring
# ===========================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
